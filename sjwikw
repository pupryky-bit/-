# https://habr.com/ru/sandbox/133055/ - source
# Самая простая змейка с turtle
import time
import turtle
from random import randrange

break_flag = False  # при укусе змеи самой себя

screen = turtle.Screen()
screen.title("Змейка с помощью turtle")
screen.bgcolor("blue")
screen.setup(650, 650)
screen.tracer(0)

# Белый бордюр игрового поля
border = turtle.Turtle()
border.color("white")
border.hideturtle()
border.penup()
border.goto(-311, 311)
border.pendown()
border.goto(311, 311)
border.goto(311, -311)
border.goto(-311, -311)
border.goto(-311, 311)

snake = list()  # список для сегментов змеи

# Цикл создания трёх сегментов змейки и окраски: нулевого
# т.е. сегмента головы белым цветом, а остальных - серым.
for i in range(3):
    snake_segment = turtle.Turtle()
    snake_segment.shape("circle")
    snake_segment.color("yellow")
    snake_segment.penup()
    if i > 0:
        snake_segment.color("grey")
    snake.append(snake_segment)
    
# Создание объекта "еда" в виде красного круга
food = turtle.Turtle()
food.shape("circle")
food.color("red")
food.penup()

# Размещение "еды" в случайных координатах x, y
food.goto(randrange(-300, 300, 20), randrange(-300, 300, 20))

# Реакция на нажатие клавиш со стрелками, черепашка
# поворачивает на соответствующее количество градусов
screen.onkeypress(lambda: snake[0].setheading(90), "Up")
screen.onkeypress(lambda: snake[0].setheading(270), "Down")
screen.onkeypress(lambda: snake[0].setheading(180), "Left")
screen.onkeypress(lambda: snake[0].setheading(0), "Right")
screen.onkeypress(lambda: exit_p(), "q")

# Ожидание нажатия клавиш
screen.listen()

while True:
    # Если змея коснулась еды, то создаётся новый сегмент змеи
    # и перерисовывается еду для змеи в новой случайной позиции
    if snake[0].distance(food) < 10:
        food.goto(randrange(-300, 300, 20), randrange(-300, 300, 20))
        snake_segment = turtle.Turtle()
        snake_segment.shape("circle")
        snake_segment.color("grey")
        snake_segment.penup()
        snake.append(snake_segment)
    # Движение тела змеи
    for i in range(len(snake) - 1, 0, -1):
        x = snake[i - 1].xcor()
        y = snake[i - 1].ycor()
        snake[i].goto(x, y)
    # Движение головы змеи
    snake[0].forward(20)
    screen.update()

    # Столкновение головы змеи с бордюром
    x_cor = snake[0].xcor()
    y_cor = snake[0].ycor()
    if x_cor > 300 or x_cor < -300:
        screen.bgcolor("black")
        break
    if y_cor > 300 or y_cor < -300:
        screen.bgcolor("black")
        break

    # Столкновение головы змеи с хвостом
    for i in snake[1:]:
        i = i.position()
        if snake[0].distance(i) < 10:
            break_flag = True
    if break_flag:
        screen.bgcolor("black")
        break

    time.sleep(0.2)

turtle.done()
